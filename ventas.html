<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ventas - Los Cabos Motors</title>

  <!-- Iconos / Fuente -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="Images/loscabosmotorsweb.png">
  <style>
    :root{
      --bg:#0c0c0c;
      --card:#151515;
      --accent:#ff3c3c;
      --muted:#bdbdbd;
      --glass: rgba(255,255,255,0.04);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:'Poppins',sans-serif;
      background:var(--bg);
      color:#fff;
      -webkit-font-smoothing:antialiased;
    }

    header {
      background-image: url('Images/bannerarticulos.png');
      background-size: cover;
      background-position: center;
      height: 280px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      position: relative;
      flex-direction: column;
    }

    header::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }

    nav {
  position: absolute;
  top: 0;
  width: 100%;
  z-index: 999;
  padding: 10px 0;
  display: flex;
  justify-content: center;
  gap: 28px;

  backdrop-filter: blur(8px);
  background: rgba(0,0,0,0.25);
  border-bottom: 1px solid rgba(255,255,255,0.06);

  transition: 0.3s ease;
}

nav a {
  color: #fff;
  font-weight: 300;
  letter-spacing: 0.5px;
  padding: 5px 10px;

  font-size: 0.95rem;
  transition: 0.25s;
  border-radius: 4px;
}

nav a:hover {
  background: rgba(255,60,60,0.25);
  color: #ff3c3c;
}

/* Para celular */
@media (max-width: 600px) {
  nav {
    gap: 14px;
    padding: 8px 0;
  }
  nav a {
    font-size: 0.85rem;
  }
}

    header h1 {
      position: relative;
      font-size: 3rem;
      text-shadow: 2px 2px 8px black;
      z-index: 1;
      margin-top: 80px;
    }
    .container{max-width:1200px;margin:28px auto;padding:0 18px;}

    .hero{
      display:flex;
      gap:18px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:18px;
    }
    .hero .title{
      display:flex;flex-direction:column;gap:6px;
    }
    .hero h2{margin:0;color:var(--accent);font-size:1.6rem;}
    .hero p{margin:0;color:var(--muted)}

    /* Layout principal: productos + carrito/form */
    .layout{
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:22px;
      align-items:start;
    }

    /* Productos */
    .products{
      display:grid;
      grid-template-columns: repeat(auto-fill,minmax(240px,1fr));
      gap:18px;
    }
    .product{
      background:var(--card);
      border-radius:12px;
      padding:14px;
      border:1px solid rgba(255,255,255,0.05);
      transition:transform .18s ease, box-shadow .18s ease;
      position:relative;
      overflow:hidden;
    }
    .product:hover{transform:translateY(-6px); box-shadow:0 12px 30px rgba(0,0,0,0.6)}
    .product img{width:100%;height:150px;object-fit:cover;border-radius:8px;margin-bottom:10px;}
    .product h3{margin:0;font-size:1.05rem}
    .product p{margin:8px 0;color:var(--muted);font-size:0.95rem}
    .price{
      font-weight:700;color:var(--accent); margin-top:6px;
    }
    .prod-controls{display:flex;gap:8px;align-items:center; margin-top:10px}
    .qty{
      width:92px;display:flex;align-items:center;gap:6px;background:var(--glass);padding:6px;border-radius:8px;
    }
    .qty button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff;padding:6px 8px;border-radius:6px;cursor:pointer}
    .qty input{width:36px;background:transparent;border:none;color:#fff;text-align:center;font-weight:600}

    .add-btn{
      margin-left:auto;background:var(--accent);border:none;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700;
      box-shadow:0 6px 18px rgba(255,60,60,0.12);
    }
    .add-btn:hover{transform:translateY(-2px)}

    /* Carrito / Form */
    .aside{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.04);
      position:sticky; top:18px;
    }
    .aside h3{margin:0 0 10px 0;color:var(--accent)}
    .cart-list{display:flex;flex-direction:column;gap:10px;max-height:340px;overflow:auto;padding-right:6px}
    .cart-item{display:flex;gap:10px;align-items:center;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px}
    .cart-item img{width:64px;height:46px;object-fit:cover;border-radius:6px}
    .cart-item .meta{flex:1}
    .cart-item .meta h4{margin:0;font-size:0.95rem}
    .cart-item .meta small{color:var(--muted);display:block}
    .cart-item .remove{background:transparent;border:none;color:#fff;font-size:18px;cursor:pointer}

    .total-row{display:flex;justify-content:space-between;align-items:center;margin-top:12px;padding-top:12px;border-top:1px dashed rgba(255,255,255,0.03)}
    .total-row strong{font-size:1.15rem}

    /* Form inputs */
    .form-group{display:flex;flex-direction:column;margin-top:12px;gap:8px}
    .form-group input, .form-group select, .form-group textarea{
      padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:#0e0e0e;color:#fff;
    }
    .small-note{font-size:0.85rem;color:var(--muted);margin-top:8px}

    .checkout-btn{
      margin-top:12px;width:100%;padding:12px;border-radius:10px;border:none;background:var(--accent);color:#fff;font-weight:800;cursor:pointer;font-size:1rem;
      display:flex;align-items:center;justify-content:center;gap:8px;
    }
    .checkout-btn.loading{opacity:.8;transform:scale(.995)}

    .pay-methods{display:flex;gap:8px;margin-top:8px}
    .pay-methods label{padding:8px 10px;border-radius:8px;background:rgba(255,255,255,0.02);cursor:pointer;border:1px solid rgba(255,255,255,0.03)}
    .pay-methods input{margin-right:8px}

    .note-delivery{margin-top:12px;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;color:var(--muted);font-size:0.95rem}

    /* Empty state */
    .empty{color:var(--muted);text-align:center;padding:18px 6px}

    /* small screens */
    @media (max-width:980px){
      .layout{grid-template-columns:1fr 340px}
    }
    @media (max-width:820px){
      .layout{grid-template-columns:1fr}
      .aside{position:relative}
    }
  </style>
</head>
<body>

  <header>
    <h1>Los Cabos Motors</h1>
    <nav>
      <a href="index.html">Inicio</a>
    <a href="ventas.html">Art√≠culos para carro</a>
    <a href="ultimas_ventas.html">√öltimas Ventas</a>
    <a href="https://wa.me/526241181978">WhatsApp</a>
    </nav>
  </header>

  <main class="container">
    <section class="hero">
      <div class="title">
        <h2>Tienda de accesorios & repuestos</h2>
        <p>Env√≠os solo en Los Cabos, BCS. Aparta y paga ‚Äî te llega pedido por WhatsApp.</p>
      </div>
      <div style="text-align:right">
        <small class="small-note">Atenci√≥n: stock limitado. Para pagarlo en l√≠nea p√≠deme link por WhatsApp.</small>
      </div>
    </section>

    <div class="layout">
      <!-- Productos -->
      <div>
        <div class="products" id="productsGrid">
          <!-- Los productos est√°n definidos desde JS y se insertan aqu√≠ -->
        </div>
      </div>

      <!-- Aside: carrito + formulario -->
      <aside class="aside">
        <h3>Tu pedido</h3>

        <div class="cart-list" id="cartList">
          <div class="empty" id="cartEmpty">No hay art√≠culos. Agrega algo :)</div>
        </div>

        <div class="total-row">
          <span>Total</span>
          <strong id="cartTotal">$0 MXN</strong>
        </div>

        <div class="form-group">
          <label>Nombre completo</label>
          <input id="c_name" placeholder="Ej. Enrique Pe√±a Nieto" />
        </div>
        <div class="form-group">
          <label>Tel√©fono (WhatsApp)</label>
          <input id="c_phone" placeholder="Ej. +52 624 123 4567" />
        </div>

        <div class="form-group">
          <label>Direcci√≥n (opcional)</label>
          <input id="c_address" placeholder="Calle, colonia, referencia" />
        </div>

        <div class="form-group">
          <label>M√©todo de pago</label>
          <div class="pay-methods">
            <label><input type="radio" name="pay" value="Transferencia" checked> Transferencia / Dep√≥sito</label>
            <label><input type="radio" name="pay" value="Pago en entrega"> Pago en entrega</label>
          </div>
        </div>

        <label style="display:block;margin-top:10px;">
          <input type="checkbox" id="c_apartar" /> Apartar (reservar) este pedido
        </label>

        <p class="small-note">La p√°gina obtendr√° tu ubicaci√≥n (coordenadas) si lo permites para incluirla en el mensaje de pedido.</p>

        <button id="checkoutBtn" class="checkout-btn">
          <i class="fab fa-whatsapp"></i> Enviar pedido por WhatsApp
        </button>

        <div class="note-delivery">
          <strong>Env√≠os:</strong> Solo en Los Cabos, BCS. Para fuera de zona, consultar por WhatsApp.
        </div>
      </aside>
    </div>
  </main>

  <script>
    /*******************************
     * Datos de productos (ed√≠talos)
     * id: √∫nico, title, desc, price (number), img
     *******************************/
    const PRODUCTS = [
      {id:'lip-mustang', title:'1x Lip deportivo - Mustang 2001-2019', desc:'Lip delantero deportivo estilo GT', price: 2800, img:'ventas/lipmustang.jpg'},
      {id:'porta-placas', title:'1x Porta placas deportivo', desc:'Porta placas deportivo', price: 850, img:'ventas/portaplaca.jpg'},
      {id:'llanta-winrun', title:'1x Llanta Winrun ', desc:'93W XL 225/35ZR20', price: 1500, img:'ventas/winrunll.jpg'}  
    ];

    // WhatsApp receptor (n√∫mero de la empresa) -- no preguntaste uno, por defecto usamos este:
    const WHATSAPP_NUMBER = '526241181978'; // modifica si quieres otro

    /*******************
     * Render productos
     *******************/
    const productsGrid = document.getElementById('productsGrid');
    PRODUCTS.forEach(p => {
      const node = document.createElement('div');
      node.className = 'product';
      node.innerHTML = `
        <img src="${p.img}" alt="${p.title}">
        <h3>${p.title}</h3>
        <p>${p.desc}</p>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-top:6px;">
          <div class="price">$${p.price.toLocaleString()} MXN</div>
        </div>
        <div class="prod-controls">
          <div class="qty">
            <button class="qty-dec" data-id="${p.id}">-</button>
            <input type="number" min="1" value="1" data-id="${p.id}" class="qty-input">
            <button class="qty-inc" data-id="${p.id}">+</button>
          </div>
          <button class="add-btn" data-id="${p.id}">Agregar</button>
        </div>
      `;
      productsGrid.appendChild(node);
    });

    /*******************
     * Carrito simple
     *******************/
    let CART = {}; // id -> {product, qty}

    const cartList = document.getElementById('cartList');
    const cartTotalEl = document.getElementById('cartTotal');
    const cartEmpty = document.getElementById('cartEmpty');

    function updateCartUI(){
      const items = Object.values(CART);
      cartList.innerHTML = '';
      if(items.length === 0){
        cartList.appendChild(cartEmpty);
        cartTotalEl.textContent = '$0 MXN';
        return;
      }
      items.forEach(ci => {
        const el = document.createElement('div');
        el.className = 'cart-item';
        el.innerHTML = `
          <img src="${ci.product.img}" alt="${ci.product.title}">
          <div class="meta">
            <h4>${ci.product.title}</h4>
            <small>${ci.qty} √ó $${ci.product.price.toLocaleString()}</small>
          </div>
          <div style="text-align:right">
            <div style="font-weight:700;color:var(--accent)">$${(ci.qty * ci.product.price).toLocaleString()}</div>
            <button class="remove" data-id="${ci.product.id}" title="Remover">‚úï</button>
          </div>
        `;
        cartList.appendChild(el);
      });

      const total = items.reduce((s,i)=> s + i.product.price * i.qty, 0);
      cartTotalEl.textContent = `$${total.toLocaleString()} MXN`;

      // attach remove listeners
      cartList.querySelectorAll('.remove').forEach(btn=>{
        btn.addEventListener('click',()=> {
          const id = btn.dataset.id;
          delete CART[id];
          updateCartUI();
        });
      });
    }

    // quantity controls and add buttons
    document.querySelectorAll('.qty-inc').forEach(b=>{
      b.addEventListener('click', e=>{
        const id = b.dataset.id;
        const input = document.querySelector(`.qty-input[data-id="${id}"]`);
        input.value = Math.max(1, parseInt(input.value || 1) + 1);
      });
    });
    document.querySelectorAll('.qty-dec').forEach(b=>{
      b.addEventListener('click', e=>{
        const id = b.dataset.id;
        const input = document.querySelector(`.qty-input[data-id="${id}"]`);
        input.value = Math.max(1, parseInt(input.value || 1) - 1);
      });
    });

    document.querySelectorAll('.add-btn').forEach(b=>{
      b.addEventListener('click', e=>{
        const id = b.dataset.id;
        const product = PRODUCTS.find(x=>x.id === id);
        const input = document.querySelector(`.qty-input[data-id="${id}"]`);
        const qty = Math.max(1, parseInt(input.value||1));
        if(CART[id]) CART[id].qty += qty;
        else CART[id] = { product, qty };
        updateCartUI();
      });
    });

    /***********************
     * Geolocalizaci√≥n (opcional)
     ***********************/
    let userCoords = null;
    function fetchLocation(){
      if(!navigator.geolocation) return;
      navigator.geolocation.getCurrentPosition(pos=>{
        const {latitude, longitude} = pos.coords;
        userCoords = {lat:latitude, lng:longitude};
      }, err=>{
        // permiso denegado o error -> se ignora
        console.warn('Geolocation error or denied', err);
      }, {timeout:7000});
    }
    // intenta obtener ubicaci√≥n al entrar en la p√°gina
    fetchLocation();

    /*******************************
     * Enviar pedido por WhatsApp
     *******************************/
    const checkoutBtn = document.getElementById('checkoutBtn');

    function buildWhatsAppMessage(data){
      // data: {name, phone, address, payMethod, apartar, items, coords}
      const lines = [];
      lines.push('üì¶ *Pedido desde Tienda - Los Cabos Motors*');
      lines.push('');
      lines.push(`üë§ *Nombre:* ${data.name || '-'}`);
      lines.push(`üì± *WhatsApp:* ${data.phone || '-'}`);
      if(data.address) lines.push(`üè† *Direcci√≥n:* ${data.address}`);
      lines.push(`üí≥ *Pago:* ${data.payMethod}`);
      lines.push(`üîñ *Apartar:* ${data.apartar ? 'S√≠' : 'No'}`);
      lines.push('');
      lines.push('*Art√≠culos:*');
      data.items.forEach(it=>{
        lines.push(`- ${it.product.title} ‚Äî ${it.qty} x $${it.product.price.toLocaleString()} = $${(it.qty*it.product.price).toLocaleString()}`);
      });
      lines.push('');
      lines.push(`*Total:* $${data.total.toLocaleString()} MXN`);
      if(data.coords){
        lines.push('');
        lines.push(`üìç Ubicaci√≥n (coordenadas): https://www.google.com/maps?q=${data.coords.lat},${data.coords.lng}`);
      } else {
        lines.push('');
        lines.push('üìç Ubicaci√≥n: no compartida por el usuario');
      }
      lines.push('');
      lines.push('Por favor confirmar disponibilidad y forma de pago. Gracias.');

      return encodeURIComponent(lines.join('\n'));
    }

    checkoutBtn.addEventListener('click', async ()=>{
      // basic validation
      const items = Object.values(CART);
      if(items.length === 0){
        alert('El carrito est√° vac√≠o. Agrega alg√∫n art√≠culo.');
        return;
      }
      const name = document.getElementById('c_name').value.trim();
      const phone = document.getElementById('c_phone').value.trim();
      if(!phone){
        if(!confirm('No ingresaste n√∫mero de WhatsApp. ¬øDeseas continuar sin n√∫mero?')) return;
      }
      checkoutBtn.classList.add('loading');

      // recompute total
      const total = items.reduce((s,i)=> s + i.product.price * i.qty, 0);
      // get pay method
      const payMethodEl = document.querySelector('input[name="pay"]:checked');
      const payMethod = payMethodEl ? payMethodEl.value : 'Transferencia';
      const apartar = document.getElementById('c_apartar').checked;
      const address = document.getElementById('c_address').value.trim();

      // try to get geolocation now (better attempt)
      let coords = userCoords;
      if(!coords && navigator.geolocation){
        try {
          coords = await new Promise((res,rej)=>{
            navigator.geolocation.getCurrentPosition(p=> res({lat:p.coords.latitude, lng:p.coords.longitude}), e=> res(null), {timeout:7000});
          });
        } catch(e){ coords = null; }
      }

      const payload = {
        name, phone, address, payMethod, apartar,
        items, total, coords
      };

      // Build message and open WhatsApp:
      const text = buildWhatsAppMessage(payload);
      // WhatsApp: number without +, open via wa.me
      const wa = `https://wa.me/${WHATSAPP_NUMBER}?text=${text}`;

      // open in new tab
      window.open(wa, '_blank');

      // small visual confirmation
      checkoutBtn.classList.remove('loading');
    });

    // initial UI
    updateCartUI();
  </script>
</body>
</html>
